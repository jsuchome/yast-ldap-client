/**
 *  LDAPInit.ycp
 *  Test of Ldap:LDAPInit, LDAPError, GetFirstServer, GetFirstPort functions
 *  Jiri Suchomel <jsuchome@suse.cz>
 *  $Id$
 */

{

    include "testsuite.ycp";
    // testedfiles: Ldap.ycp

    map READ =	$[ "ldap": $[
	"error": $[
	    "msg": "Initialization failed",
	    "code": 11
	],
	"product" : $[ "features" :
	    $[ "EVMS_CONFIG" : "nazdar" ],
	],
    ]];
    map EX =	$[ "ldap": true  ];
    map EX_F =	$[ "ldap": false ];

    TESTSUITE_INIT([READ,$[],$[]], nil);

    import "Ldap";

    DUMP ("==== init (one server, no port set) ==============");

    Ldap::server = "localhost";

    DUMP (sformat ("==== value of server: \"%1\"", Ldap::server));

    TEST(``(Ldap::LDAPInit ()), [ $[], $[], EX ], 0);

    DUMP ("==== init (one server, nonsence port set) ========");

    Ldap::server = "localhost:sdgfd#$";

    DUMP (sformat ("==== value of server: \"%1\"", Ldap::server));

    TEST(``(Ldap::LDAPInit ()), [ $[], $[], EX ], 0);

    DUMP ("==== init (more servers set, TLS used) ===========");

    Ldap::server = "chimera.suse.cz:333 localhost";
    Ldap::ldap_v2 = true;
    Ldap::ldap_tls = true;

    DUMP (sformat ("==== value of server: \"%1\"", Ldap::server));

    TEST(``(Ldap::LDAPInit ()), [ $[], $[], EX ], 0);

    DUMP ("==== init failed =================================");

    TEST(``(Ldap::LDAPInit ()), [ READ, $[], EX_F ], 0);

}
